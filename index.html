<!DOCTYPE html>
<html>
<head>
  <title>ReelShorts Carousel</title>
  <style>
    body { margin:0; font-family: Arial; overflow-x:hidden; background:black; color:white; }
    #carousel { display:flex; overflow-x:auto; scroll-snap-type:x mandatory; height:100vh; }

    .episode-container {
      min-width: 100%;
      height: 100vh;
      scroll-snap-align:start;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      background:black;
    }

    .locked {
      display:flex;
      justify-content:center;
      align-items:center;
      font-size:28px;
      cursor:pointer;
      text-align:center;
      padding:20px;
    }

    .tap-overlay {
      position:absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
      display:flex;
      flex-direction: column;
      justify-content:center;
      align-items:center;
      z-index:2;
      font-size:24px;
      color:white;
      background: rgba(0,0,0,0.6);
      pointer-events:none; /* overlay does not block iframe click */
    }

    .loading-overlay {
      position:absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
      display:flex;
      flex-direction: column;
      justify-content:center;
      align-items:center;
      z-index:3;
      background: rgba(0,0,0,0.8);
      color:white;
      font-size:24px;
      display:flex; /* always visible during pre-roll */
    }

    .spinner {
      border: 6px solid rgba(255,255,255,0.3);
      border-top: 6px solid white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-bottom: 10px;
    }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    #paywall {
      position: fixed;
      top:50%; left:50%;
      transform: translate(-50%, -50%);
      padding: 20px;
      border: 2px solid #aaa;
      background: #fff;
      color:black;
      display: none;
      z-index: 10;
      text-align:center;
    }
    #close-paywall { margin-left:10px; }

    .arrow {
      position: absolute;
      top: 50%;
      font-size: 48px;
      color: white;
      background: rgba(0,0,0,0.3);
      padding: 10px;
      cursor: pointer;
      z-index: 5;
      user-select: none;
    }
    #arrow-left { left: 10px; transform: translateY(-50%); }
    #arrow-right { right: 10px; transform: translateY(-50%); }
  </style>
</head>
<body>

<div id="carousel"></div>
<div id="arrow-left" class="arrow">&#10094;</div>
<div id="arrow-right" class="arrow">&#10095;</div>

<div id="paywall">
  <h3>Unlock All Episodes</h3>
  <p>Purchase the full season to access all locked episodes.</p>
  <a href="YOUR_PAYPAL_LINK_HERE" target="_blank">
    <button>Unlock Now</button>
  </a>
  <button id="close-paywall">Close</button>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
const episodes = [
  { yt: "aKk1p0EiWXs", ad: "AD_VIDEO_ID_1", free: true },
  { yt: "CuK_NZ01u-I", ad: "AD_VIDEO_ID_2", free: true },
  { yt: "Q8rHDvj4asE", ad: "AD_VIDEO_ID_3", free: true },
  { yt: "EPISODE_VIDEO_ID_4", ad: "AD_VIDEO_ID_4", free: false },
  { yt: "EPISODE_VIDEO_ID_5", ad: "AD_VIDEO_ID_5", free: false }
];

const carousel = document.getElementById("carousel");
const paywall = document.getElementById("paywall");
const closePay = document.getElementById("close-paywall");
let unlocked = JSON.parse(localStorage.getItem("unlocked")) || false;
const players = [];
const stateFlags = [];

function renderCarousel() {
  carousel.innerHTML = "";

  episodes.forEach((ep, i) => {
    const container = document.createElement("div");
    container.className = "episode-container";

    if (!ep.free && !unlocked) {
      container.classList.add("locked");
      container.innerText = "Locked – Tap to Unlock";
      container.onclick = () => { paywall.style.display = "block"; };
    } else {
      const playerDiv = document.createElement("div");
      playerDiv.id = `player-${i}`;
      playerDiv.style.width = "100%";
      playerDiv.style.height = "100%";
      playerDiv.style.opacity = 0;
      container.appendChild(playerDiv);

      const tapOverlay = document.createElement("div");
      tapOverlay.className = "tap-overlay";
      tapOverlay.id = `tap-overlay-${i}`;
      tapOverlay.innerHTML = "<div>▶ VIDEO LOADING...</div>";
      container.appendChild(tapOverlay);

      const loadingOverlay = document.createElement("div");
      loadingOverlay.className = "loading-overlay";
      loadingOverlay.innerHTML = `<div class="spinner"></div><div>Loading...</div>`;
      container.appendChild(loadingOverlay);

      stateFlags[i] = { preRollDone: false, tapOverlay, loadingOverlay };
    }

    carousel.appendChild(container);
  });
}

function onYouTubeIframeAPIReady() {
  episodes.forEach((ep, i) => {
    if (!ep.free && !unlocked) return;

    players[i] = new YT.Player(`player-${i}`, {
      height: '100%',
      width: '100%',
      videoId: ep.ad,
      playerVars: { 'rel':0, 'modestbranding':1, 'autoplay':1, 'mute':1 },
      events: {
        onReady: function(event) {
          event.target.playVideo(); // autoplay muted
        },
        onStateChange: function(event) {
          const container = carousel.children[i];
          const playerDiv = container.querySelector(`#player-${i}`);
          const flags = stateFlags[i];

          if (event.data === YT.PlayerState.PLAYING) {
            playerDiv.style.opacity = 1;

            // Hide tap overlay after first frame
            if (flags.tapOverlay) flags.tapOverlay.style.display = "none";

            // Pre-roll → main episode transition
            if (!flags.preRollDone) {
              setTimeout(() => {
                players[i].loadVideoById({videoId: ep.yt, startSeconds:0});
                players[i].unMute();
                flags.preRollDone = true;
              }, 10000); // 10s pre-roll
            } else {
              if (flags.loadingOverlay) flags.loadingOverlay.style.display = "none";
            }
          }
        }
      }
    });
  });
}

// Arrow navigation
document.getElementById('arrow-left').onclick = () => {
  carousel.scrollBy({ left: -window.innerWidth, behavior: 'smooth' });
};
document.getElementById('arrow-right').onclick = () => {
  carousel.scrollBy({ left: window.innerWidth, behavior: 'smooth' });
};

// Paywall
closePay.onclick = () => { paywall.style.display = "none"; };

renderCarousel();
</script>

</body>
</html>
